---
title: 拥塞控制原理
id: 6
---

- 拥塞：太多的数据需要网络传输，超过了网络的处理能力
- 与流量控制不同
- 拥塞的表现
  - 分组丢失（路由器缓冲区溢出）
  - 分组经历比较长的延迟（在路由器的队列中排队）



### 拥塞原因与代价

情况1 ：两个发送方和一台具有无穷大缓存的路由器，输出链路带宽为R且没有重传

吞吐量上限由两条连接之间共享链路容量造成，即最大为R/2，当发送速率在0~R/2之间，接收方的吞吐量等于发送方的发送速率

当发送速率接近R/2，排队时延陡增，平均时延陡增

![image-20210821080358267](/img/Network/计算机网络/传输层/image-20210821080358267.png)





情况2：两个发送方和一台具有有限缓存的路由器

- 分组丢失时，发送端重传
  - 应用层的输入=应用层输出：$\lambda_{in}=\lambda_{out}$
  - 传输层的输入包括重传：$\lambda_{in}\geq\lambda_{out}$



理想化1：发送端知道什么时候路由器的缓冲是可用的

![image-20210821081124973](/img/Network/计算机网络/传输层/image-20210821081124973.png)

- 只在缓冲可用时发送
- 不会丢失：$\lambda_{in^{'}}=\lambda_{in}$



理想化2：掌握丢失信息，分组可以丢失，在路由器由于缓冲器满而被丢弃，若知道分组丢失了，发送方重传分组

当以R/2的速度发送时 , 一些分组是重传的 ，有效输出渐进逼近R/2，在发送方不仅包括发送的数据还包括重传数据

![image-20210821081546986](/img/Network/计算机网络/传输层/image-20210821081546986.png)



现实情况：重复

- 分组可能丢失，由于缓冲器满而被丢弃

- 发送端最终超时，发送第2个拷贝，2个分组都被传出

- 输出比输入少原因

  - 重传的丢失分组
  - 没有必要重传的重复分组

  ![image-20210821082126992](/img/Network/计算机网络/传输层/image-20210821082126992.png)

- 拥塞的“代价”

  - 为了达到一个有效输出，网络需要做更多的工作（重传）
  - 没有必要的重传，链路中包括了多个分组的拷贝，是那些没有丢失，经历的时间比较长（拥塞状态）但是超时的分组





情况3：4个发送方和具有有限缓存的多台路由器及多跳路径

![image-20210821082535145](/img/Network/计算机网络/传输层/image-20210821082535145.png)

当分组丢失时，任何“关于这个分组的上游传输能力” 都被浪费了，最终形成死锁

![image-20210821082948105](/img/Network/计算机网络/传输层/image-20210821082948105.png)





### 拥塞控制方法

端到端拥塞控制

- 没有来自网络的显式反馈
- 端系统根据延迟和丢失事件推断是否有拥塞
- TCP采用的方法

网络辅助的拥塞控制

- 路由器提供给端系统以反馈信息
  - 单个bit置位，显示有拥塞（SNA, DECbit,  TCP/IP ECN, ATM）
  - 显式提供发送端可以采用的速率



案例分析：ATM ABR 拥塞控制（网络辅助的拥塞控制）

ATM发送的数据为信元



ABR: available bit rate

- “弹性服务”
- 如果发送端的路径“轻载 ”，发送方使用可用带宽
- 如果发送方的路径拥塞了，发送方限制其发送的速度到一个最小保障速率上



RM (资源管理) 信元（显示通知）

- 由发送端发送，在数据信元中间隔插入
- RM信元中的比特被交换机设置（“网络辅助”）
  - NI bit: no increase in  rate (轻微拥塞)速率不要增加
  - CI bit: congestion  indication 拥塞指示
- 发送端发送的RM信元被接收端返回，接收端不做任何改变
- 在RM信元中的2个字节 ER (explicit rate)字段
  - 拥塞的交换机可能会降低信元中ER的值
  - 发送端发送速度因此是最低的可支持速率
- 数据信元中的EFCI bit: 被拥塞的交换机设置成1，如果在管理信元RM前面的数据信元EFCI被设置成了1, 接收端在返回的RM信元中设置CI bit